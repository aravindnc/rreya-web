name: Replace wp-json

on:
  push:
    branches: [main]

jobs:
  replace-string:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v2
        
        
      - name: Replace wp-json
        run: |          
          find . -type f \( -name "*.js" -o -name "*.html" \) -exec sed -i 's/\/wp-json/https:\/\/rreya.com\/wp-json\//g' {} +
          
      - name: Commit Changes
        run: |
          git config --global user.email "aravind_n_c@yahoo.co.in"
          git config --global user.name "Aravind NC"
          git commit -am "[Automation] Cleanup for publishing."
          # git push

      - name: Fetch Publish Branch
        run: |
          git fetch origin publish:publish

      - name: Push Changes to Publish Branch
        run: |
          git checkout publish
          git merge --no-ff main
          git push origin publish

      - name: Allow github-actions bot to push changes
        uses: ad-m/github-push-action@master
        with:
          github_token: '${{ secrets.PAT_TOKEN }}'
